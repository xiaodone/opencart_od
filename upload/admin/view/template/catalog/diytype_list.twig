{{ header }}{{ column_left }}
<div id="content">
  

<div style="margin:20px;">

	<button type="button" onclick="add()" class="layui-btn">新增</button>
	<table id="demo" lay-filter="test"></table>	
  <div id="form" style="display:none">
<form class="layui-form" lay-filter="formTest" onsubmit="return false">
  <div class="layui-form-item">
    <label class="layui-form-label">中文标题</label>
    <div class="layui-input-block">
      <input type="text" name="title" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">英文标题</label>
    <div class="layui-input-block">
      <input type="text" name="entitle" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">中文描述</label>
    <div class="layui-input-block">
      <textarea name="text" placeholder="请输入内容" class="layui-textarea"></textarea>
    </div>
  </div>
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">英文描述</label>
    <div class="layui-input-block">
      <textarea name="entext" placeholder="请输入内容" class="layui-textarea"></textarea>
    </div>
  </div>
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">图片</label>
    <div class="layui-input-block">
    <a href="" id="thumb-image1" data-toggle="image" class="img-thumbnail"><img src="{{ placeholder }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a><input type="hidden" name="thumb" value="" id="input_image1" />
    </div>
  </div>
  <input type="hidden" name="id" />
  <input type="hidden" name="sort_order" value="0" />
  <div class="layui-form-item">
    <div class="layui-input-block">
      <span class="layui-btn" lay-submit lay-filter="formDemo">立即提交</span>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>
</div>
</div></div>
<link rel="stylesheet" href="https://cdn.staticfile.org/layui/2.5.7/css/layui.min.css">

<script src="https://cdn.staticfile.org/layui/2.5.7/layui.min.js"></script>
<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
  
</script>

<script>

layui.use(['table', 'form', 'upload', 'layer'], function(){
  var form = layui.form;
  
  form.on('submit(formDemo)', function(data){
    post(data)
    
    return false;
  });

  
  var table = layui.table;
  
  //第一个实例
  table.render({
    elem: '#demo'
    ,height: 412
    ,url: window.location.href + '&ajax=1' //数据接口
    ,page: false //开启分页
    ,cols: [[ //表头
      {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
      ,{field: 'title', title: '中文名称', width:400}
      ,{field: 'entitle', title: '英文名称', width:400}
      ,{fixed: 'right', title: '操作',  align:'center', toolbar: '#barDemo'}
    ]]
  });

  table.on('tool(test)', function(obj){
    var data = obj.data; //获得当前行数据
    var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
    var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
   
    if(layEvent === 'detail'){ //查看
      console.log(data)
    } else if(layEvent === 'del'){ //删除
      layer.confirm('真的删除行么', function(index){
        obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
        
        //向服务端发送删除指令
        $.post('index.php?route=catalog/diytype/delete&user_token={{ user_token }}&id=' + data.id, {}, function(res){
            layer.msg('删除成功')
            layer.close(index);
        })
      });
    } else if(layEvent === 'edit'){ //编辑
      $('#thumb-image1 img').attr('src', data.thumbs)
      form.val("formTest", data);
      add()
    } else if(layEvent === 'LAYTABLE_TIPS'){
      layer.alert('Hi，头部工具栏扩展的右侧图标。');
    }
  });
      
  
});
function add(obj){
  layer.open({
    area: ['640px', '600px'],
    type: 1,
    content: $('#form') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
  });
}

function post(data){
  $.post(window.location.href + '&save=1', data.field, function(){
      layer.msg('保存成功', {
      icon: 1,
      time: 2000 //2秒关闭（如果不配置，默认是3秒）
    }, function(){
      window.location.reload();
    }); 
     
  })
}
</script>
<style>
#modal-image{z-index:9999900000}
</style>
{{ footer }}